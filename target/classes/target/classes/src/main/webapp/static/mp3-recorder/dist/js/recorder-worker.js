//devin87@qq.com
//build:2015/12/30 08:59:59
!function(e){"use strict";function a(){"undefined"!=typeof console&&console.log.apply(console,arguments)}function n(e,a){self.postMessage({cmd:e,data:a})}function t(e){p.push(new Int8Array(e))}function r(){p=[]}function o(e){u=e.numChannels||1,f=e.inputSampleRate,m=Math.min(e.outputSampleRate||f,f),r();var a=new lamejs;l=new a.Mp3Encoder(u,m,e.bitRate||128)}function s(e){var a;if(f!=m)for(var n=f/m,t=Math.ceil(e.length/n),a=new Float32Array(t),r=0,o=0;t>r;o+=n)a[r++]=e[~~o];else a=new Float32Array(e);for(var t=a.length,s=new Int16Array(t),o=0;t>o;o++){var c=Math.max(-1,Math.min(1,a[o]));s[o]=0>c?32768*c:32767*c}return s}function c(a){for(var n=s(a[0]),r=u>1?s(a[1]):e,o=1152,c=n.length,i=c,f=0;i>=o;f+=o){var m=n.subarray(f,f+o),p=r?r.subarray(f,f+o):e,d=l.encodeBuffer(m,p);t(d),i-=o}}function i(){t(l.flush()),n("complete",p),r()}a("mp3 recorder worker started!"),importScripts("./lame.all.js");var l,u,f,m,p=[];self.onmessage=function(e){var a=e.data,n=a.data;switch(a.cmd){case"init":o(n);break;case"encode":c(n);break;case"stop":i()}}}();